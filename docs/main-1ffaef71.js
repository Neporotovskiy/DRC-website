(this.webpackJsonp=this.webpackJsonp||[]).push([[4],{"+dzc":function(e,t,n){"use strict";n.d(t,"Uploading",function(){return g});var r=n("q1tI"),a=n.n(r),o=n("TSYQ"),u=n.n(o),i=n("OBjG"),l=n("iDPU"),s=n.n(l);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=p(this,(e=d(t)).call.apply(e,[this].concat(a)))).state={files:[],valid:!1,dropPointStyle:null},n.onEnterHandler=function(e){e.stopPropagation(),e.preventDefault()},n.onOverHandler=function(e){e.stopPropagation(),e.preventDefault(),n.setState({dropPointStyle:s.a.hovered})},n.onLeaveHandler=function(e){e.stopPropagation(),e.preventDefault(),n.setState({dropPointStyle:null})},n.onDropHandler=function(e){e.stopPropagation(),e.preventDefault(),n.setState({dropPointStyle:null}),n.renderFileItems(e.dataTransfer.files)},n.onInputFieldClearHandler=function(e){return e.target.value=null},n.onInputValueChangeHandler=function(e){n.renderFileItems(e.target.files)},n.makeFileListIterable=function(e){for(var t=[],n=0;n<=e.length;n++){var r=e.item(n);r&&t.push(r)}return t},n.renderFileItems=function(e){var t=[];n.makeFileListIterable(e).forEach(function(r){n.isFileAlreadyUploaded(n.state.files,r.name,r.size)||n.readFileContent(r,function(a,o){t.push({name:r.name,size:r.size,content:a,processable:o}),t.length===e.length&&n.setState({files:n.state.files.concat(t)})})})},n.isFileAlreadyUploaded=function(e,t,n){return e.some(function(e){var r=e.name===t,a=e.size===n;return r&&a})},n.readFileContent=function(e,t){if("application/json"===e.type){var n=new FileReader;n.onload=function(e){var n=e.target,r=JSON.parse(n.result);["meta","blueprints"].every(function(e){return e in r})?t(r,!0):t(null,!1)},n.readAsText(e,"UTF-8")}else t(null,!1)},n.removeFile=function(e){return function(){n.setState({files:n.state.files.filter(function(t){return t.name!==e})})}},n.onContinue=function(){var e=n.state,t=e.files,r=e.valid,a=n.props.onContinue;r&&a(t)},n}var n,o,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,r["PureComponent"]),n=t,(o=[{key:"componentDidUpdate",value:function(){var e=this.state,t=e.files,n=e.valid,r=t.length>0,a=t.every(function(e){return e.processable}),o=r&&a;n!==o&&this.setState({valid:o})}},{key:"render",value:function(){var e=this,t=this.state,n=t.files,r=t.dropPointStyle,o=t.valid,l=this.props,c=l.active,f=l.passed;return a.a.createElement(i.Section,{active:c,passed:f,valid:o,onContinue:this.onContinue,title:a.a.createElement("div",{className:"title"},a.a.createElement("span",null,a.a.createElement("b",null,"Шаг №1"),": Выберите подготовленный ",a.a.createElement("b",null,"json")," файл."),a.a.createElement("a",{target:"_blank",href:"manual.html#files-selection",title:"Инструкция к первому шагу",className:"help"},"?"))},a.a.createElement("p",null,"Поместите файл(ы) в область ниже, или кликните по ней для вызова окна выбора файла."),a.a.createElement("input",{type:"file",id:s.a.filesTarget,multiple:!0,hidden:!0,onChange:this.onInputValueChangeHandler,onClick:this.onInputFieldClearHandler}),a.a.createElement("label",{htmlFor:s.a.filesTarget,className:u()(s.a.filesSelector,r),onDragEnter:this.onEnterHandler,onDragOver:this.onOverHandler,onDragLeave:this.onLeaveHandler,onDrop:this.onDropHandler},"Перетащите или выберите файлы"),n.length>0?a.a.createElement("ul",{className:s.a.uploadedFiles},n.map(function(t){var n,r,o,i=t.name,l=t.size,c=t.processable;return a.a.createElement("li",{className:s.a.fileItem,title:c?i:"Данный файл содержит некорректную структуру содержимого или необрабатываемый MIME-тип и не будет использован",key:i},a.a.createElement("b",{className:u()(s.a.name,(n={},r=s.a.processable,o=c,r in n?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,n))},i),a.a.createElement("b",{className:s.a.size},Math.ceil(l/1024)),a.a.createElement("span",{className:s.a.removeButton,onClick:e.removeFile(i)}))})):null)}}])&&f(n.prototype,o),l&&f(n,l),t}()},UUDo:function(e,t,n){"use strict";n.d(t,"Processing",function(){return E});var r=n("q1tI"),a=n.n(r),o=n("OBjG"),u=n("xR2o"),i=n("6VFr"),l=n("xmC6"),s=n.n(l),c=n("gS4H"),f=n.n(c);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){g(e,t,n[t])})}return e}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=m(this,(e=y(t)).call.apply(e,[this].concat(a)))).STEPS={1:"Установка параметров: Длина заготовки.",2:"Установка параметров: Ширина режущей кромки.",3:"Установка параметров: Точность расчетов.",4:"Работа: Оптимизация структуры данных.",5:"Работа: Выстраивание оптимальных последовательностей.",6:"Работа: Группировка повторяющихся последовательностей.",7:"Работа: Дополнение структуры данных в последовательностях.",8:"Готово.",9:"Анализ: Сбор информации о затратах материала.",10:"Готово."},n.workers=[],n.createInitialFileEntities=function(){var e={};return n.props.data.uploading.forEach(function(t,n){e[n]={phase:0,status:null,calculations:null,analysis:null,isPreviewVisible:!1}}),e},n.getFileEntityByID=function(e){return n.props.data.uploading[e]},n.getCalculationParameters=function(){return n.props.data.parametrization},n.updateFileEntityInState=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};n.setState(function(n){var r=n[e];return g({},e,h({},r,t))},r)},n.handleCalculationsCoreMessages=function(e,t){var r=t.label,a=t.data,o=n.state.status;switch(r){case"status":n.updateFileEntityInState(e,{status:n.STEPS[a]});break;case"error":n.updateFileEntityInState(e,{phase:0,status:o});break;case"calculations":n.updateFileEntityInState(e,{calculations:a});break;case"analysis":n.updateFileEntityInState(e,{phase:2,analysis:a});break;default:console.error("Unknown message label received")}},n.createCalculationsCoreInstance=function(e){return function(){var t=n.getFileEntityByID(e).content.blueprints,r=n.getCalculationParameters(),a=r.assetLength,o=r.calculationAccuracy,u=r.cuttingEdge,i=new s.a;i.addEventListener("message",function(t){var r=t.data;n.handleCalculationsCoreMessages(e,r)}),i.postMessage({label:"run",blueprints:t,assetLength:a,calculationAccuracy:o,cuttingEdge:u}),n.workers.push(i)}},n.runCoreCalculations=function(e){return function(){n.updateFileEntityInState(e,{phase:1},n.createCalculationsCoreInstance(e))}},n.showPreview=function(e){return function(){n.updateFileEntityInState(e,{isPreviewVisible:!0})}},n.hidePreview=function(e){return function(){n.updateFileEntityInState(e,{isPreviewVisible:!1})}},n.onBack=function(){n.workers.forEach(function(e){return e.terminate()}),n.props.onBack()},n.PHASES={0:{disabled:!1,handler:n.runCoreCalculations,content:"Расчитать"},1:{disabled:!0,handler:null,content:"Расчет..."},2:{disabled:!1,handler:n.showPreview,content:"Просмотр"}},n}var n,l,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,r["Component"]),n=t,(l=[{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.data.uploading,r=t.active,a=e.data.uploading,o=e.active;(null!==n&&null===a||!r&&o)&&this.setState(this.createInitialFileEntities())}},{key:"render",value:function(){var e=this,t=this.props,n=t.active,r=t.passed,l=t.data,s=l.uploading,c=l.parametrization;return a.a.createElement(o.Section,{active:n,passed:r,onBack:this.onBack,title:a.a.createElement("div",{className:"title"},a.a.createElement("span",null,a.a.createElement("b",null,"Шаг №3"),": Рассчитайте и распечатайте результат."),a.a.createElement("a",{target:"_blank",href:"manual.html#calculation-and-rendering",title:"Инструкция к третьему шагу",className:"help"},"?"))},function(){return s.map(function(t,n){var r=t.name,o=t.size,l=t.content.meta,s=e.state[n],p=s.phase,g=s.status,b=s.isPreviewVisible,m=s.calculations,y=s.analysis,v=e.PHASES[p],E=v.disabled,S=v.handler,w=v.content,O=null===S?{}:{onClick:S(n)};return a.a.createElement("div",{className:f.a.container,key:n},a.a.createElement(u.Meta,{meta:l}),a.a.createElement("div",{className:f.a.controls},a.a.createElement("span",{className:f.a.name},"Имя файла: ",a.a.createElement("b",null,r)),a.a.createElement("span",{className:f.a.size},"Размер файла: ",a.a.createElement("b",null,Math.round(o/1024),"kb")),g&&a.a.createElement("span",{className:f.a.status},g),a.a.createElement("button",d({className:"button",disabled:E},O),w)),b?a.a.createElement(i.Preview,d({},c,{onClose:e.hidePreview(n),blueprints:m,meta:h({},l,y)})):null)})})}}])&&b(n.prototype,l),c&&b(n,c),t}()},gS4H:function(e,t,n){e.exports={container:"container-1Xrjc",controls:"controls-3T19_",name:"name-V1nD1",size:"size-11V4h",status:"status-3SANB"}},iDPU:function(e,t,n){e.exports={"files-target":"files-target-1uCFE",filesTarget:"files-target-1uCFE","files-selector":"files-selector-2oSZm",filesSelector:"files-selector-2oSZm",hovered:"hovered-3fOBA","uploaded-files":"uploaded-files-3S25Q",uploadedFiles:"uploaded-files-3S25Q","file-item":"file-item-60kR5",fileItem:"file-item-60kR5",name:"name-1NZIk",size:"size-VD98N",processable:"processable-1n0r7","remove-button":"remove-button-I6VIw",removeButton:"remove-button-I6VIw"}},xmC6:function(e,t,n){e.exports=function(){return n("d4XP")('!function(t){var e={};function r(n){if(e[n])return e[n].exports;var u=e[n]={i:n,l:!1,exports:{}};return t[n].call(u.exports,u,u.exports,r),u.l=!0,u.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var u in t)r.d(n,u,function(e){return t[e]}.bind(null,u));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s="xmC6")}({p4U6:function(t,e,r){self,t.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var u=e[n]={i:n,l:!1,exports:{}};return t[n].call(u.exports,u,u.exports,r),u.l=!0,u.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var u in t)r.d(n,u,function(e){return t[e]}.bind(null,u));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";function n(t,e){for(var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,n=e,u=!1,o=0;!u;){n<=0&&(u=!0);var s=t.find(function(t){return Number(t.length)===Number(n.toFixed(r))});void 0!==s&&(u=!0,o=s),n-=Math.pow(10,-r)}return o}function u(t,e){var r=t.findIndex(function(t){return t.index===e.index});0<=r&&t.splice(r,1)}function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=[],n=!0,u=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!e||r.length!==e);n=!0);}catch(t){u=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(u)throw o}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}r.r(e),r.d(e,"DelmaResourceCalculatorCore",function(){return a});var a=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data=e,this.output=null,this.logger=function(){}}var e,r;return e=t,(r=[{key:"setLogger",value:function(t){return this.logger=t,this}},{key:"setAssetLength",value:function(t){return this.assetLength=t,this.logger({step:1,status:1}),this}},{key:"setCuttingEdgeWidth",value:function(t){return this.cuttingEdge=t,this.logger({step:2,status:1}),this}},{key:"setCalculationAccuracy",value:function(t){return this.calculationAccuracy=t,this.logger({step:3,status:1}),this}},{key:"calculate",value:function(t){try{var e=function(t){try{var e=[];return t.forEach(function(t,r){for(var n=t.length,u=t.number,o=0;o<u;o++)e.push({index:r,length:n})}),e.sort(function(t,e){return e.length-t.length}),{err:null,result:e}}catch(t){return{err:t,result:null}}}(this.data),r=e.err,s=e.result;if(r)return this.logger({step:4,status:0,error:r}),this;this.logger({step:4,status:1});var a=function(t,e){var r,s=e.assetLength,a=e.cuttingEdge,l=e.calculationAccuracy;try{var i=function(t){return t.map(function(t){return function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),n.forEach(function(e){var n,u,o;n=t,o=r[u=e],u in n?Object.defineProperty(n,u,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[u]=o})}return t}({},t)})}(t),c=[],f=[];do{if(0<f.length){var g=0===(r=f).length?0:r.reduce(function(t,e){return t+e.length},0),h=s-a*f.length-g;if(0<h){var p=n(i,h,l);p?(u(i,p),f.push(p)):(c.push(f),f=[])}else c.push(f),f=[]}else{var d=o(i,1)[0];f.push(d),u(i,d)}0===i.length&&c.push(f)}while(0<i.length);return{err:null,result:c}}catch(t){return{err:t,result:null}}}(s,{assetLength:this.assetLength,cuttingEdge:this.cuttingEdge,calculationAccuracy:this.calculationAccuracy}),l=a.err,i=a.result;if(l)return this.logger({step:5,status:0,error:l}),this;this.logger({step:5,status:1});var c=function(t){try{var e={},r=[];return t.forEach(function(t){var r="";t.forEach(function(t){r+=t.index}),r in e?e[r].push(t):e[r]=[t]}),Object.values(e).forEach(function(t){r.push({group:t[0],number:t.length})}),{err:null,result:r}}catch(t){return{err:t,result:null}}}(i),f=c.err,g=c.result;if(f)return this.logger({step:6,status:0,error:f}),this;this.logger({step:6,status:1});var h=function(t,e){try{var r=[];return t.forEach(function(t){var n=t.group,u=t.number,o=[];n.forEach(function(t){var r=t.index;o.push(e[r])}),r.push({group:o,number:u})}),{err:null,result:r}}catch(t){return{err:t,result:null}}}(g,this.data),p=h.err,d=h.result;if(p)return this.logger({step:7,status:0,error:p}),this;this.logger({step:7,status:1}),t(this.output=d),this.logger({step:8,status:1})}catch(t){this.output=null,this.logger({step:8,status:0,error:t})}return this}},{key:"analyze",value:function(t){var e=this;if(null===this.output)return this;try{var r=null,n=null;try{this.logger({step:9,status:1}),r=this.output.reduce(function(t,e){return t+e.number},0),n=this.output.reduce(function(t,r){var n=r.group,u=n.reduce(function(t,e){return t+e.length},0);return t+(e.assetLength-u-(n.length-e.cuttingEdge))},0)}catch(t){this.logger({step:9,status:0,error:t})}t({totalConsumption:r,totalWaste:n}),this.logger({step:10,status:1})}catch(t){this.logger({step:10,status:0,error:t})}return this}}])&&s(e.prototype,r),t}()}])},xmC6:function(t,e,r){"use strict";r.r(e);var n=r("p4U6");self.addEventListener("message",({data:{label:t,...e}})=>{switch(t){case"run":!function({blueprints:t,assetLength:e,calculationAccuracy:r,cuttingEdge:u}){new n.DelmaResourceCalculatorCore(t).setLogger(({step:t,error:e})=>{const r=void 0!==e;r?self.postMessage({label:"error",data:e.message}):self.postMessage({label:"status",data:t})}).setAssetLength(e).setCalculationAccuracy(r).setCuttingEdgeWidth(u).calculate(t=>{self.postMessage({label:"calculations",data:t})}).analyze(t=>{self.postMessage({label:"analysis",data:t}),self.close()})}(e);break;default:self.postMessage({label:"error",data:"Unknown message received by worker instance"})}})}});',n.p+"a048b7926d82ca319894.worker.js")}}}]);